<!-- Hero Section -->
<section class="hero-section">
  <div class="container">
    <h1 class="hero-title">
      {{ isEditMode ? 'Modifier l\'Actualit√©' : 'Nouvelle Actualit√©' }}
    </h1>
    <p class="hero-description">
      {{ isEditMode ? 'Modifiez les informations de l\'actualit√©' : 'Cr√©ez une nouvelle actualit√© avec upload d\'images depuis votre machine' }}
    </p>
  </div>
</section>

<!-- Section Formulaire -->
<section class="form-section">
  <div class="container">
    <div class="form-container">
      
      <!-- Chargement -->
      <div class="loading-overlay" *ngIf="loading">
        <div class="loading-content">
          <i class="pi pi-spin pi-spinner"></i>
          <p>Chargement de l'actualit√©...</p>
        </div>
      </div>

      <!-- Formulaire principal -->
      <form [formGroup]="actualiteForm" (ngSubmit)="onSubmit()" *ngIf="!loading">
        <div class="form-grid">
          
          <!-- Colonne Gauche - Contenu Principal -->
          <div class="main-content">
            <p-card header="Informations Principales" styleClass="main-card">
              
              <!-- Titre -->
              <div class="form-group">
                <label for="titre" class="form-label">
                  Titre de l'actualit√© <span class="required">*</span>
                </label>
                <input type="text" 
                       id="titre"
                       pInputText 
                       formControlName="titre"
                       placeholder="Entrez le titre de l'actualit√©"
                       [class]="getFieldClass('titre')"
                       class="form-input">
                <div class="field-footer">
                  <small class="form-error" *ngIf="hasError('titre')">
                    {{ getErrorMessage('titre') }}
                  </small>
                  <span class="char-count" 
                        [style.color]="getCharCountColor(titreCharCount, 200)">
                    {{ titreCharCount }}/200 caract√®res
                  </span>
                </div>
              </div>

              <!-- Description -->
              <div class="form-group">
                <label for="description" class="form-label">
                  Description courte <span class="required">*</span>
                </label>
                <textarea id="description"
                          pInputTextarea
                          formControlName="description"
                          placeholder="R√©sum√© de l'actualit√© qui appara√Ætra dans la liste"
                          rows="3"
                          [class]="getFieldClass('description')"
                          class="form-textarea">
                </textarea>
                <div class="field-footer">
                  <small class="form-error" *ngIf="hasError('description')">
                    {{ getErrorMessage('description') }}
                  </small>
                  <span class="char-count" 
                        [style.color]="getCharCountColor(descriptionCharCount, 500)">
                    {{ descriptionCharCount }}/500 caract√®res
                  </span>
                </div>
              </div>

              <!-- Contenu complet -->
              <div class="form-group">
                <label for="contenu" class="form-label">
                  Contenu d√©taill√©
                </label>
                <textarea id="contenu"
                          pInputTextarea
                          formControlName="contenu"
                          placeholder="Contenu complet de l'actualit√© (optionnel)"
                          rows="8"
                          [class]="getFieldClass('contenu')"
                          class="form-textarea">
                </textarea>
                <div class="field-footer">
                  <small class="form-error" *ngIf="hasError('contenu')">
                    {{ getErrorMessage('contenu') }}
                  </small>
                  <span class="char-count" 
                        [style.color]="getCharCountColor(contenuCharCount, 2000)">
                    {{ contenuCharCount }}/2000 caract√®res
                  </span>
                </div>
              </div>

              <!-- Auteur -->
              <div class="form-group">
                <label for="auteur" class="form-label">
                  Auteur <span class="required">*</span>
                </label>
                <input type="text" 
                       id="auteur"
                       pInputText 
                       formControlName="auteur"
                       placeholder="Nom de l'auteur"
                       [class]="getFieldClass('auteur')"
                       class="form-input">
                <small class="form-error" *ngIf="hasError('auteur')">
                  {{ getErrorMessage('auteur') }}
                </small>
              </div>

            </p-card>
          </div>

          <!-- Colonne Droite - Param√®tres -->
          <div class="sidebar-content">
            
            <!-- Upload d'Image Locale -->
            <p-card header="üì∑ Image de l'actualit√©" styleClass="sidebar-card">
              <div class="image-section">

                <!-- Zone d'Upload -->
                <div class="upload-zone" *ngIf="!imagePreview && !isCompressing">
                  <p-fileUpload 
                    mode="basic" 
                    chooseLabel="üìÅ Choisir une image" 
                    accept="image/*" 
                    maxFileSize="5000000"
                    (onSelect)="onFileSelect($event)"
                    [auto]="false"
                    styleClass="upload-btn">
                  </p-fileUpload>
                  
                  <div class="upload-info">
                    <p class="upload-title">üì§ T√©l√©chargez votre image</p>
                    <ul class="upload-specs">
                      <li>‚úÖ Formats support√©s : JPG, PNG, WebP, GIF</li>
                      <li>üìè Taille max : 5MB (sera automatiquement compress√©e)</li>
                      <li>üìê Dimensions recommand√©es : 1200x800 pixels</li>
                      <li>‚ö° Compression automatique pour optimiser la performance</li>
                    </ul>
                  </div>
                </div>

                <!-- Progression de Compression -->
                <div class="compression-section" *ngIf="isCompressing">
                  <div class="compression-info">
                    <h4>üîÑ Optimisation de l'image en cours...</h4>
                    <p>Compression et redimensionnement automatique</p>
                  </div>
                  
                  <p-progressBar 
                    [value]="compressionProgress" 
                    [showValue]="true"
                    styleClass="compression-progress">
                  </p-progressBar>
                  
                  <div class="compression-steps">
                    <div class="step" [class.active]="compressionProgress >= 20">
                      <span class="step-icon">üìñ</span>
                      <span class="step-text">Lecture du fichier</span>
                    </div>
                    <div class="step" [class.active]="compressionProgress >= 40">
                      <span class="step-icon">üìê</span>
                      <span class="step-text">Calcul des dimensions</span>
                    </div>
                    <div class="step" [class.active]="compressionProgress >= 60">
                      <span class="step-icon">üóúÔ∏è</span>
                      <span class="step-text">Compression</span>
                    </div>
                    <div class="step" [class.active]="compressionProgress >= 80">
                      <span class="step-icon">‚úÖ</span>
                      <span class="step-text">Validation</span>
                    </div>
                  </div>
                </div>

                <!-- Pr√©visualisation de l'Image -->
                <div class="image-preview-section" *ngIf="imagePreview && !isCompressing">
                  <div class="image-preview">
                    <img [src]="imagePreview" alt="Aper√ßu de l'image" class="preview-image">
                    <div class="image-overlay">
                      <button type="button" 
                              pButton 
                              icon="pi pi-times" 
                              class="p-button-rounded p-button-danger p-button-sm remove-btn"
                              pTooltip="Supprimer l'image"
                              (click)="onFileRemove()">
                      </button>
                    </div>
                  </div>
                  
                  <div class="image-info">
                    <p class="image-status">‚úÖ Image optimis√©e et pr√™te</p>
                    <div class="image-actions">
                      <button type="button" 
                              pButton 
                              label="üîÑ Changer d'image" 
                              class="p-button-outlined p-button-sm"
                              (click)="onFileRemove()">
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Conseils d'optimisation -->
                <div class="optimization-tips" *ngIf="!isCompressing">
                  <h5>üí° Conseils pour de meilleures images :</h5>
                  <ul>
                    <li><strong>üìè Format :</strong> Privil√©giez le format paysage (16:9 ou 4:3)</li>
                    <li><strong>üé® Qualit√© :</strong> Images nettes et bien √©clair√©es</li>
                    <li><strong>üìê Taille :</strong> Plus c'est grand, mieux c'est (on compresse apr√®s)</li>
                    <li><strong>üöÄ Performance :</strong> La compression automatique optimise le chargement</li>
                  </ul>
                </div>

              </div>
            </p-card>

            <!-- Param√®tres de publication -->
            <p-card header="‚öôÔ∏è Param√®tres" styleClass="sidebar-card">
              
              <!-- Cat√©gorie -->
              <div class="form-group">
                <label for="categorie" class="form-label">
                  Cat√©gorie <span class="required">*</span>
                </label>
                <p-dropdown id="categorie"
                            formControlName="categorie"
                            [options]="categories"
                            placeholder="S√©lectionnez une cat√©gorie"
                            optionLabel="label"
                            optionValue="value"
                            [class]="getFieldClass('categorie')"
                            styleClass="w-full">
                  <ng-template pTemplate="selectedItem" let-option>
                    <div class="category-option" *ngIf="option">
                      <i [class]="option.icon"></i>
                      <span>{{ option.label }}</span>
                    </div>
                  </ng-template>
                  <ng-template pTemplate="item" let-option>
                    <div class="category-option">
                      <i [class]="option.icon"></i>
                      <span>{{ option.label }}</span>
                    </div>
                  </ng-template>
                </p-dropdown>
                <small class="form-error" *ngIf="hasError('categorie')">
                  {{ getErrorMessage('categorie') }}
                </small>
              </div>

              <!-- Date de publication -->
              <div class="form-group">
                <label for="datePublication" class="form-label">
                  Date de publication <span class="required">*</span>
                </label>
                <p-calendar id="datePublication"
                            formControlName="datePublication"
                            dateFormat="dd/mm/yy"
                            placeholder="S√©lectionnez une date"
                            [class]="getFieldClass('datePublication')"
                            styleClass="w-full">
                </p-calendar>
                <small class="form-error" *ngIf="hasError('datePublication')">
                  {{ getErrorMessage('datePublication') }}
                </small>
              </div>

              <!-- Date d'√©v√©nement -->
              <div class="form-group">
                <label for="dateEvenement" class="form-label">
                  Date d'√©v√©nement
                </label>
                <p-calendar id="dateEvenement"
                            formControlName="dateEvenement"
                            dateFormat="dd/mm/yy"
                            placeholder="Date de l'√©v√©nement (optionnel)"
                            styleClass="w-full">
                </p-calendar>
                <small class="form-hint">
                  Uniquement pour les √©v√©nements
                </small>
              </div>

              <!-- √âtat de publication -->
              <div class="form-group">
                <div class="publish-toggle">
                  <p-checkbox formControlName="publie"
                              binary="true"
                              inputId="publie">
                  </p-checkbox>
                  <label for="publie" class="checkbox-label">
                    Publier imm√©diatement
                  </label>
                </div>
                <small class="publish-hint">
                  Si d√©coch√©, l'actualit√© sera sauvegard√©e en brouillon
                </small>
              </div>

            </p-card>

          </div>
        </div>

        <!-- Actions du formulaire -->
        <div class="form-actions">
          <div class="actions-left">
            <button type="button" 
                    pButton 
                    label="‚ùå Annuler" 
                    icon="pi pi-times"
                    class="p-button-text p-button-secondary cancel-btn"
                    (click)="cancel()">
            </button>
          </div>

          <div class="actions-right">
            <button type="button" 
                    pButton 
                    label="üíæ Brouillon" 
                    icon="pi pi-save"
                    class="p-button-outlined draft-btn"
                    (click)="saveDraft()"
                    [disabled]="submitting || isCompressing">
            </button>
            
            <button type="button" 
                    pButton 
                    label="üëÅÔ∏è Aper√ßu" 
                    icon="pi pi-eye"
                    class="p-button-help preview-btn"
                    (click)="preview()"
                    [disabled]="actualiteForm.invalid || isCompressing">
            </button>
            
            <button type="submit" 
                    pButton 
                    [label]="isEditMode ? '‚úèÔ∏è Mettre √† jour' : '‚ú® Cr√©er l\'actualit√©'"
                    [icon]="submitting ? 'pi pi-spin pi-spinner' : (isEditMode ? 'pi pi-check' : 'pi pi-plus')"
                    class="submit-btn"
                    [disabled]="actualiteForm.invalid || submitting || isCompressing">
            </button>
          </div>
        </div>

      </form>
    </div>
  </div>
</section>

<!-- Toast pour les notifications -->
<p-toast position="top-right"></p-toast>